<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Japanese Kana Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#fff;
  --fg:#111;
  --card:#f3f4f6;
  --accent:#2563eb;
  --green:#16a34a;
  --red:#dc2626;
}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--fg);
}
.app{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  margin-bottom:16px;
}
.hidden{display:none}

button,input{
  padding:10px;
  font-size:16px;
}
button{cursor:pointer}

.option-group{margin-top:20px}
.option-title{font-weight:700;margin-bottom:8px}
.option-row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}
.small{font-size:13px;opacity:.75}

.kana{
  font-size:96px;
  text-align:center;
  margin:20px 0;
}

#answer{
  width:100%;
  max-width:420px;
  margin:14px auto 0;
  display:block;
  background:#fff;
  border:2px solid #cbd5e1;
  border-radius:10px;
  padding:14px 16px;
  font-size:18px;
  text-align:center;
}
#answer.correct{background:var(--green);color:#fff}
#answer.wrong{background:var(--red);color:#fff}

/* progress bar */
.progress-wrap{
  width:100%;
  height:10px;
  background:#e5e7eb;
  border-radius:8px;
  overflow:hidden;
  margin-bottom:16px;
}
#progressBar{
  height:100%;
  width:0%;
  background:var(--accent);
  transition:width .25s ease;
}

/* chart */
.chart-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
  gap:12px;
}
.chart-item{
  background:#fff;
  padding:10px;
  border-radius:8px;
  text-align:center;
}
.chart-char{font-size:32px}
.chart-romaji{font-size:12px;opacity:.7}

/* nav */
#navBar{
  position:fixed;
  top:12px;
  left:12px;
  display:flex;
  gap:10px;
  z-index:1000;
}
#navBar button{
  padding:8px 12px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #cbd5e1;
  background:var(--card);
}
#navBar button:hover{
  background:var(--accent);
  color:#fff;
}

/* print (PDF export) */
@media print{
  body *{visibility:hidden}
  #chartPage, #chartPage *{visibility:visible}
  #chartPage{
    position:absolute;
    left:0;top:0;width:100%;
  }
  #navBar, button{display:none!important}
}
</style>
</head>

<body>

<div id="navBar">
  <button id="homeBtn">üè†</button>
  <button id="backBtn" class="hidden">‚¨Ö</button>
</div>

<div class="app">

<!-- SETUP -->
<div id="setup" class="card">
  <h2>Japanese Kana Quiz</h2>

  <div class="option-group">
    <div class="option-title">Script</div>
    <div class="option-row">
      <label><input type="checkbox" id="useHira" checked> Hiragana</label>
      <label><input type="checkbox" id="useKata"> Katakana</label>
    </div>
  </div>

  <div class="option-group">
    <div class="option-title">Type</div>
    <div class="option-row">
      <label><input type="checkbox" id="useBasic" checked> Basic</label>
      <label><input type="checkbox" id="useDakuten"> Dakuten / Handakuten</label>
      <label><input type="checkbox" id="useCombined"> Y≈çon</label>
    </div>
    <div id="typeCountPreview" class="small"></div>
  </div>

  <div class="option-row" style="margin-top:24px">
    <button id="startBtn">Start Quiz</button>
    <button onclick="openChart('hiragana')">Hiragana Chart</button>
    <button onclick="openChart('katakana')">Katakana Chart</button>
  </div>
</div>

<!-- QUIZ -->
<div id="quiz" class="card hidden">
  <div class="progress-wrap"><div id="progressBar"></div></div>
  <div id="kana" class="kana"></div>
  <input id="answer" autocomplete="off" placeholder="Type romaji and press Enter">
</div>

<!-- RESULT -->
<div id="resultPage" class="card hidden">
  <h3>Result</h3>
  <p>Total: <span id="resTotal"></span></p>
  <p>Correct: <span id="resCorrect"></span></p>
  <p>Accuracy: <span id="resAccuracy"></span>%</p>

  <h4>Accuracy by Type</h4>
  <ul>
    <li>Basic: <span id="accBasic">-</span>%</li>
    <li>Dakuten: <span id="accDakuten">-</span>%</li>
    <li>Y≈çon: <span id="accYoon">-</span>%</li>
  </ul>

  <h4>Wrong Answers</h4>
  <div id="wrongPreview" class="chart-grid"></div>

  <button onclick="restartQuiz()">Restart</button>
  <button id="retryWrongBtn" onclick="retryWrong()">Retry Wrong Only</button>
</div>

<!-- CHART -->
<div id="chartPage" class="card hidden">
  <h2 id="chartTitle"></h2>
  <div style="margin-bottom:12px">
    <button onclick="exportChartPDF()">Export to PDF</button>
  </div>

  <h3>Basic</h3><div id="chartBasic" class="chart-grid"></div>
  <h3>Dakuten</h3><div id="chartDakuten" class="chart-grid"></div>
  <h3>Handakuten</h3><div id="chartHandakuten" class="chart-grid"></div>
  <h3>Y≈çon</h3><div id="chartCombined" class="chart-grid"></div>
</div>

</div>

<script>
/* ================= DATASETS  ================= */


const HIRA_BASIC = [
 ["„ÅÇ","a"],["„ÅÑ","i"],["„ÅÜ","u"],["„Åà","e"],["„Åä","o"],
 ["„Åã","ka"],["„Åç","ki"],["„Åè","ku"],["„Åë","ke"],["„Åì","ko"],
 ["„Åï","sa"],["„Åó","shi"],["„Åô","su"],["„Åõ","se"],["„Åù","so"],
 ["„Åü","ta"],["„Å°","chi"],["„Å§","tsu"],["„Å¶","te"],["„Å®","to"],
 ["„Å™","na"],["„Å´","ni"],["„Å¨","nu"],["„Å≠","ne"],["„ÅÆ","no"],
 ["„ÅØ","ha"],["„Å≤","hi"],["„Åµ","fu"],["„Å∏","he"],["„Åª","ho"],
 ["„Åæ","ma"],["„Åø","mi"],["„ÇÄ","mu"],["„ÇÅ","me"],["„ÇÇ","mo"],
 ["„ÇÑ","ya"],["„ÇÜ","yu"],["„Çà","yo"],
 ["„Çâ","ra"],["„Çä","ri"],["„Çã","ru"],["„Çå","re"],["„Çç","ro"],
 ["„Çè","wa"],["„Çí","wo"],["„Çì","n"]
];

const KATA_BASIC = [
 ["„Ç¢","a"],["„Ç§","i"],["„Ç¶","u"],["„Ç®","e"],["„Ç™","o"],
 ["„Ç´","ka"],["„Ç≠","ki"],["„ÇØ","ku"],["„Ç±","ke"],["„Ç≥","ko"],
 ["„Çµ","sa"],["„Ç∑","shi"],["„Çπ","su"],["„Çª","se"],["„ÇΩ","so"],
 ["„Çø","ta"],["„ÉÅ","chi"],["„ÉÑ","tsu"],["„ÉÜ","te"],["„Éà","to"],
 ["„Éä","na"],["„Éã","ni"],["„Éå","nu"],["„Éç","ne"],["„Éé","no"],
 ["„Éè","ha"],["„Éí","hi"],["„Éï","fu"],["„Éò","he"],["„Éõ","ho"],
 ["„Éû","ma"],["„Éü","mi"],["„É†","mu"],["„É°","me"],["„É¢","mo"],
 ["„É§","ya"],["„É¶","yu"],["„É®","yo"],
 ["„É©","ra"],["„É™","ri"],["„É´","ru"],["„É¨","re"],["„É≠","ro"],
 ["„ÉØ","wa"],["„É≤","wo"],["„É≥","n"]
];

const HIRA_DAKUTEN = [
 ["„Åå","ga"],["„Åé","gi"],["„Åê","gu"],["„Åí","ge"],["„Åî","go"],
 ["„Åñ","za"],["„Åò","ji"],["„Åö","zu"],["„Åú","ze"],["„Åû","zo"],
 ["„Å†","da"],["„Å¢","ji"],["„Å•","zu"],["„Åß","de"],["„Å©","do"],
 ["„Å∞","ba"],["„Å≥","bi"],["„Å∂","bu"],["„Åπ","be"],["„Åº","bo"]
];

const HIRA_HANDAKUTEN = [
 ["„Å±","pa"],["„Å¥","pi"],["„Å∑","pu"],["„Å∫","pe"],["„ÅΩ","po"]
];

const KATA_DAKUTEN = [
 ["„Ç¨","ga"],["„ÇÆ","gi"],["„Ç∞","gu"],["„Ç≤","ge"],["„Ç¥","go"],
 ["„Ç∂","za"],["„Ç∏","ji"],["„Ç∫","zu"],["„Çº","ze"],["„Çæ","zo"],
 ["„ÉÄ","da"],["„ÉÇ","ji"],["„ÉÖ","zu"],["„Éá","de"],["„Éâ","do"],
 ["„Éê","ba"],["„Éì","bi"],["„Éñ","bu"],["„Éô","be"],["„Éú","bo"]
];

const KATA_HANDAKUTEN = [
 ["„Éë","pa"],["„Éî","pi"],["„Éó","pu"],["„Éö","pe"],["„Éù","po"]
];

const HIRA_COMBINED = [
 ["„Åç„ÇÉ","kya"],["„Åç„ÇÖ","kyu"],["„Åç„Çá","kyo"],
 ["„Åó„ÇÉ","sha"],["„Åó„ÇÖ","shu"],["„Åó„Çá","sho"],
 ["„Å°„ÇÉ","cha"],["„Å°„ÇÖ","chu"],["„Å°„Çá","cho"],
 ["„Å´„ÇÉ","nya"],["„Å´„ÇÖ","nyu"],["„Å´„Çá","nyo"],
 ["„Å≤„ÇÉ","hya"],["„Å≤„ÇÖ","hyu"],["„Å≤„Çá","hyo"],
 ["„Åø„ÇÉ","mya"],["„Åø„ÇÖ","myu"],["„Åø„Çá","myo"],
 ["„Çä„ÇÉ","rya"],["„Çä„ÇÖ","ryu"],["„Çä„Çá","ryo"],
 ["„Åé„ÇÉ","gya"],["„Åé„ÇÖ","gyu"],["„Åé„Çá","gyo"],
 ["„Åò„ÇÉ","ja"],["„Åò„ÇÖ","ju"],["„Åò„Çá","jo"],
 ["„Å≥„ÇÉ","bya"],["„Å≥„ÇÖ","byu"],["„Å≥„Çá","byo"],
 ["„Å¥„ÇÉ","pya"],["„Å¥„ÇÖ","pyu"],["„Å¥„Çá","pyo"]
];

const KATA_COMBINED = [
 ["„Ç≠„É£","kya"],["„Ç≠„É•","kyu"],["„Ç≠„Éß","kyo"],
 ["„Ç∑„É£","sha"],["„Ç∑„É•","shu"],["„Ç∑„Éß","sho"],
 ["„ÉÅ„É£","cha"],["„ÉÅ„É•","chu"],["„ÉÅ„Éß","cho"],
 ["„Éã„É£","nya"],["„Éã„É•","nyu"],["„Éã„Éß","nyo"],
 ["„Éí„É£","hya"],["„Éí„É•","hyu"],["„Éí„Éß","hyo"],
 ["„Éü„É£","mya"],["„Éü„É•","myu"],["„Éü„Éß","myo"],
 ["„É™„É£","rya"],["„É™„É•","ryu"],["„É™„Éß","ryo"],
 ["„ÇÆ„É£","gya"],["„ÇÆ„É•","gyu"],["„ÇÆ„Éß","gyo"],
 ["„Ç∏„É£","ja"],["„Ç∏„É•","ju"],["„Ç∏„Éß","jo"],
 ["„Éì„É£","bya"],["„Éì„É•","byu"],["„Éì„Éß","byo"],
 ["„Éî„É£","pya"],["„Éî„É•","pyu"],["„Éî„Éß","pyo"]
];
/* ================= STATE ================= */
let currentView="setup";
let pool=[],index=0;
let correctCount=0;
let wrongAnswers=[];
let stats={basic:{t:0,c:0},dakuten:{t:0,c:0},yoon:{t:0,c:0}};

/* ================= COUNT PREVIEW ================= */
function updateTypeCountPreview(){
  let b=0,d=0,y=0;
  if(useBasic.checked){
    if(useHira.checked) b+=HIRA_BASIC.length;
    if(useKata.checked) b+=KATA_BASIC.length;
  }
  if(useDakuten.checked){
    if(useHira.checked) d+=HIRA_DAKUTEN.length+HIRA_HANDAKUTEN.length;
    if(useKata.checked) d+=KATA_DAKUTEN.length+KATA_HANDAKUTEN.length;
  }
  if(useCombined.checked){
    if(useHira.checked) y+=HIRA_COMBINED.length;
    if(useKata.checked) y+=KATA_COMBINED.length;
  }
  typeCountPreview.innerHTML=
    `Basic: <b>${b}</b> | Dakuten/Handakuten: <b>${d}</b> | Y≈çon: <b>${y}</b> | Total: <b>${b+d+y}</b>`;
}
[useHira,useKata,useBasic,useDakuten,useCombined]
  .forEach(e=>e.onchange=updateTypeCountPreview);
updateTypeCountPreview();

/* ================= QUIZ ================= */
startBtn.onclick=()=>{
  currentView="quiz";
  backBtn.classList.remove("hidden");

  pool=[];index=0;correctCount=0;wrongAnswers=[];
  stats={basic:{t:0,c:0},dakuten:{t:0,c:0},yoon:{t:0,c:0}};
  progressBar.style.width="0%";

  if(useBasic.checked){
    if(useHira.checked) pool.push(...HIRA_BASIC);
    if(useKata.checked) pool.push(...KATA_BASIC);
  }
  if(useDakuten.checked){
    if(useHira.checked) pool.push(...HIRA_DAKUTEN,...HIRA_HANDAKUTEN);
    if(useKata.checked) pool.push(...KATA_DAKUTEN,...KATA_HANDAKUTEN);
  }
  if(useCombined.checked){
    if(useHira.checked) pool.push(...HIRA_COMBINED);
    if(useKata.checked) pool.push(...KATA_COMBINED);
  }
  if(!pool.length) return alert("Select at least one option");

  pool.sort(()=>Math.random()-0.5);
  setup.classList.add("hidden");
  quiz.classList.remove("hidden");
  nextKana();
};

function nextKana(){
  kana.textContent=pool[index][0];
  answer.value="";
  answer.focus();
  progressBar.style.width=`${(index/pool.length)*100}%`;
}

answer.onkeydown=e=>{
  if(e.key==="Enter"){
    const cur=pool[index];
    const ok=answer.value.trim().toLowerCase()===cur[1];

    let type="basic";
    if(HIRA_DAKUTEN.includes(cur)||HIRA_HANDAKUTEN.includes(cur)
    ||KATA_DAKUTEN.includes(cur)||KATA_HANDAKUTEN.includes(cur)) type="dakuten";
    else if(HIRA_COMBINED.includes(cur)||KATA_COMBINED.includes(cur)) type="yoon";

    stats[type].t++;
    if(ok){correctCount++;stats[type].c++;}
    else if(!wrongAnswers.includes(cur)) wrongAnswers.push(cur);

    answer.className=ok?"correct":"wrong";
    setTimeout(()=>{
      answer.className="";
      index++;
      index>=pool.length?showResult():nextKana();
    },250);
  }
};

/* ================= RESULT ================= */
function showResult(){
  currentView="result";
  backBtn.classList.remove("hidden");

  quiz.classList.add("hidden");
  resultPage.classList.remove("hidden");

  resTotal.textContent=pool.length;
  resCorrect.textContent=correctCount;
  resAccuracy.textContent=Math.round(correctCount/pool.length*100);

  accBasic.textContent=stats.basic.t?Math.round(stats.basic.c/stats.basic.t*100):"-";
  accDakuten.textContent=stats.dakuten.t?Math.round(stats.dakuten.c/stats.dakuten.t*100):"-";
  accYoon.textContent=stats.yoon.t?Math.round(stats.yoon.c/stats.yoon.t*100):"-";

  wrongPreview.innerHTML=wrongAnswers.length
    ? wrongAnswers.map(k=>`
      <div class="chart-item">
        <div class="chart-char">${k[0]}</div>
        <div class="chart-romaji">${k[1]}</div>
      </div>`).join("")
    : `<div style="opacity:.7">None üéâ</div>`;

  retryWrongBtn.disabled=!wrongAnswers.length;
  progressBar.style.width="100%";
}

function restartQuiz(){ goHome(); }

/* retry wrong only */
function retryWrong(){
  if(!wrongAnswers.length) return;

  pool=[...wrongAnswers];
  index=0;correctCount=0;wrongAnswers=[];
  stats={basic:{t:0,c:0},dakuten:{t:0,c:0},yoon:{t:0,c:0}};
  progressBar.style.width="0%";

  resultPage.classList.add("hidden");
  quiz.classList.remove("hidden");
  currentView="quiz";
  nextKana();
}

/* ================= NAV ================= */
function goHome(){
  setup.classList.remove("hidden");
  quiz.classList.add("hidden");
  chartPage.classList.add("hidden");
  resultPage.classList.add("hidden");
  backBtn.classList.add("hidden");
  currentView="setup";
}
backBtn.onclick=()=>{
  if(currentView==="quiz" && !confirm("Exit quiz and lose progress?")) return;
  goHome();
};
homeBtn.onclick=backBtn.onclick;
document.addEventListener("keydown",e=>{
  if(e.altKey&&e.key==="ArrowLeft") backBtn.click();
});

/* ================= CHART ================= */
function openChart(type){
  currentView="chart";
  backBtn.classList.remove("hidden");

  setup.classList.add("hidden");
  chartPage.classList.remove("hidden");

  chartTitle.textContent=type==="hiragana"?"Hiragana Chart":"Katakana Chart";
  chartBasic.innerHTML=render(type==="hiragana"?HIRA_BASIC:KATA_BASIC);
  chartDakuten.innerHTML=render(type==="hiragana"?HIRA_DAKUTEN:KATA_DAKUTEN);
  chartHandakuten.innerHTML=render(type==="hiragana"?HIRA_HANDAKUTEN:KATA_HANDAKUTEN);
  chartCombined.innerHTML=render(type==="hiragana"?HIRA_COMBINED:KATA_COMBINED);
}
function render(arr){
  return arr.map(k=>`
    <div class="chart-item">
      <div class="chart-char">${k[0]}</div>
      <div class="chart-romaji">${k[1]}</div>
    </div>`).join("");
}

/* export chart */
function exportChartPDF(){
  window.print();
}
</script>
</body>
</html>