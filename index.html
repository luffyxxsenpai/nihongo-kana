<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Japanese Kana Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================== BASE ================== */
:root{
  --bg:#ffffff;
  --fg:#111;
  --card:#f3f4f6;
  --accent:#2563eb;
  --green:#16a34a;
  --red:#dc2626;
}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:var(--bg);
  color:var(--fg);
}

.app{
  max-width:900px;
  margin:auto;
  padding:20px;
  position:relative;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  margin-bottom:16px;
}

button,input,select{
  padding:10px;
  font-size:16px;
}

button{
  cursor:pointer;
}

.hidden{ display:none; }

/* ================== GLOBAL BACK ================== */
.global-back{
  position:absolute;
  top:16px;
  right:16px;
  width:40px;
  height:40px;
  border-radius:50%;
  border:1px solid #cbd5e1;
  background:var(--card);
  font-size:18px;
}

.global-back:hover{
  background:var(--accent);
  color:white;
}

/* ================== SETUP OPTIONS ================== */
.option-group{
  margin-top:24px;
}

.option-group-title{
  font-weight:700;
  font-size:16px;
  margin-bottom:12px;
}

.option-row{
  display:flex;
  gap:32px;
  align-items:center;
}

.option-row label{
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}

/* ================== QUIZ ================== */
.kana{
  font-size:96px;
  text-align:center;
  margin:20px 0;
}

.progress{
  height:10px;
  background:#cbd5e1;
  border-radius:8px;
  overflow:hidden;
}

.progress-inner{
  height:100%;
  background:var(--accent);
  width:0%;
}

.timer{
  text-align:center;
  font-weight:bold;
  margin-top:8px;
}

.correct{ background:var(--green); color:white; }
.wrong{ background:var(--red); color:white; }

/* ================== CHART ================== */
.chart-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(80px,1fr));
  gap:10px;
  margin-bottom:20px;
}

.chart-item{
  background:#fff;
  padding:10px;
  border-radius:8px;
  text-align:center;
}

.chart-char{ font-size:32px; }
.chart-romaji{ font-size:12px; opacity:.7; }

/* ================== PRINT (PDF EXPORT) ================== */
@media print{
  body *{ visibility:hidden; }
  #chartPage, #chartPage *{ visibility:visible; }

  #chartPage{
    position:absolute;
    inset:0;
    background:white;
  }

  .global-back,
  #exportPdfBtn{
    display:none !important;
  }

  h2,h3{ page-break-after:avoid; }
  .chart-grid{ page-break-inside:avoid; }
}
</style>
</head>

<body>

<button id="globalBackBtn" class="global-back hidden" title="Back">‚¨Ö</button>

<div class="app">

<!-- ================== SETUP ================== -->
<div id="setup" class="card">
  <h2>Japanese Kana Quiz</h2>

  <div class="option-group">
    <div class="option-group-title">Script</div>
    <div class="option-row">
      <label><input type="checkbox" id="useHira" checked> Hiragana</label>
      <label><input type="checkbox" id="useKata"> Katakana</label>
    </div>
  </div>

  <div class="option-group">
    <div class="option-group-title">Type</div>
    <div class="option-row">
      <label><input type="checkbox" id="useBasic" checked> Basic (46)</label>
      <label><input type="checkbox" id="useCombined"> Combined</label>
    </div>
  </div>

  <div class="option-group">
    <div class="option-group-title">Mode</div>
    <select id="mode">
      <option value="normal">Normal</option>
      <option value="timer">Timer</option>
    </select>
  </div>

  <div id="timerOptions" class="hidden">
    <select id="timePreset">
      <option>1</option><option>2</option><option selected>3</option>
      <option>5</option><option>8</option>
    </select>
    <input id="customTime" type="number" placeholder="Custom seconds">
  </div>

  <button id="startBtn">Start Quiz</button>
  <button onclick="openChart('hiragana')">View Hiragana Chart</button>
  <button onclick="openChart('katakana')">View Katakana Chart</button>
</div>

<!-- ================== QUIZ ================== -->
<div id="quiz" class="card hidden">
  <div class="progress"><div id="progress" class="progress-inner"></div></div>
  <div id="timer" class="timer"></div>
  <div id="kana" class="kana"></div>
  <input id="answer" autocomplete="off" placeholder="Type romaji and press Enter">
</div>

<!-- ================== CHART PAGE ================== -->
<div id="chartPage" class="card hidden">
  <h2 id="chartTitle"></h2>
  <button id="exportPdfBtn">üìÑ Export as PDF</button>

  <h3>Basic 46</h3>
  <div id="chartBasic" class="chart-grid"></div>

  <h3>Dakuten</h3>
  <div id="chartDakuten" class="chart-grid"></div>

  <h3>Handakuten</h3>
  <div id="chartHandakuten" class="chart-grid"></div>

  <h3>Combined (Y≈çon)</h3>
  <div id="chartCombined" class="chart-grid"></div>
</div>

</div>

<script>
/* ================== DATA ================== */
const HIRA_BASIC=[["„ÅÇ","a"],["„ÅÑ","i"],["„ÅÜ","u"],["„Åà","e"],["„Åä","o"],["„Åã","ka"],["„Åç","ki"],["„Åè","ku"],["„Åë","ke"],["„Åì","ko"],["„Åï","sa"],["„Åó","shi"],["„Åô","su"],["„Åõ","se"],["„Åù","so"],["„Åü","ta"],["„Å°","chi"],["„Å§","tsu"],["„Å¶","te"],["„Å®","to"],["„Å™","na"],["„Å´","ni"],["„Å¨","nu"],["„Å≠","ne"],["„ÅÆ","no"],["„ÅØ","ha"],["„Å≤","hi"],["„Åµ","fu"],["„Å∏","he"],["„Åª","ho"],["„Åæ","ma"],["„Åø","mi"],["„ÇÄ","mu"],["„ÇÅ","me"],["„ÇÇ","mo"],["„ÇÑ","ya"],["„ÇÜ","yu"],["„Çà","yo"],["„Çâ","ra"],["„Çä","ri"],["„Çã","ru"],["„Çå","re"],["„Çç","ro"],["„Çè","wa"],["„Çí","wo"],["„Çì","n"]];
const KATA_BASIC=[["„Ç¢","a"],["„Ç§","i"],["„Ç¶","u"],["„Ç®","e"],["„Ç™","o"],["„Ç´","ka"],["„Ç≠","ki"],["„ÇØ","ku"],["„Ç±","ke"],["„Ç≥","ko"],["„Çµ","sa"],["„Ç∑","shi"],["„Çπ","su"],["„Çª","se"],["„ÇΩ","so"],["„Çø","ta"],["„ÉÅ","chi"],["„ÉÑ","tsu"],["„ÉÜ","te"],["„Éà","to"],["„Éä","na"],["„Éã","ni"],["„Éå","nu"],["„Éç","ne"],["„Éé","no"],["„Éè","ha"],["„Éí","hi"],["„Éï","fu"],["„Éò","he"],["„Éõ","ho"],["„Éû","ma"],["„Éü","mi"],["„É†","mu"],["„É°","me"],["„É¢","mo"],["„É§","ya"],["„É¶","yu"],["„É®","yo"],["„É©","ra"],["„É™","ri"],["„É´","ru"],["„É¨","re"],["„É≠","ro"],["„ÉØ","wa"],["„É≤","wo"],["„É≥","n"]];

const HIRA_DAKUTEN=[["„Åå","ga"],["„Åé","gi"],["„Åê","gu"],["„Åí","ge"],["„Åî","go"],["„Åñ","za"],["„Åò","ji"],["„Åö","zu"],["„Åú","ze"],["„Åû","zo"],["„Å†","da"],["„Å¢","ji"],["„Å•","zu"],["„Åß","de"],["„Å©","do"],["„Å∞","ba"],["„Å≥","bi"],["„Å∂","bu"],["„Åπ","be"],["„Åº","bo"]];
const KATA_DAKUTEN=[["„Ç¨","ga"],["„ÇÆ","gi"],["„Ç∞","gu"],["„Ç≤","ge"],["„Ç¥","go"],["„Ç∂","za"],["„Ç∏","ji"],["„Ç∫","zu"],["„Çº","ze"],["„Çæ","zo"],["„ÉÄ","da"],["„ÉÇ","ji"],["„ÉÖ","zu"],["„Éá","de"],["„Éâ","do"],["„Éê","ba"],["„Éì","bi"],["„Éñ","bu"],["„Éô","be"],["„Éú","bo"]];

const HIRA_HANDAKUTEN=[["„Å±","pa"],["„Å¥","pi"],["„Å∑","pu"],["„Å∫","pe"],["„ÅΩ","po"]];
const KATA_HANDAKUTEN=[["„Éë","pa"],["„Éî","pi"],["„Éó","pu"],["„Éö","pe"],["„Éù","po"]];

const HIRA_COMBINED=[["„Åç„ÇÉ","kya"],["„Åç„ÇÖ","kyu"],["„Åç„Çá","kyo"],["„Åó„ÇÉ","sha"],["„Åó„ÇÖ","shu"],["„Åó„Çá","sho"],["„Å°„ÇÉ","cha"],["„Å°„ÇÖ","chu"],["„Å°„Çá","cho"],["„Å´„ÇÉ","nya"],["„Å´„ÇÖ","nyu"],["„Å´„Çá","nyo"],["„Å≤„ÇÉ","hya"],["„Å≤„ÇÖ","hyu"],["„Å≤„Çá","hyo"],["„Åø„ÇÉ","mya"],["„Åø„ÇÖ","myu"],["„Åø„Çá","myo"],["„Çä„ÇÉ","rya"],["„Çä„ÇÖ","ryu"],["„Çä„Çá","ryo"]];
const KATA_COMBINED=[["„Ç≠„É£","kya"],["„Ç≠„É•","kyu"],["„Ç≠„Éß","kyo"],["„Ç∑„É£","sha"],["„Ç∑„É•","shu"],["„Ç∑„Éß","sho"],["„ÉÅ„É£","cha"],["„ÉÅ„É•","chu"],["„ÉÅ„Éß","cho"],["„Éã„É£","nya"],["„Éã„É•","nyu"],["„Éã„Éß","nyo"],["„Éí„É£","hya"],["„Éí„É•","hyu"],["„Éí„Éß","hyo"],["„Éü„É£","mya"],["„Éü„É•","myu"],["„Éü„Éß","myo"],["„É™„É£","rya"],["„É™„É•","ryu"],["„É™„Éß","ryo"]];

/* ================== STATE ================== */
let pool=[],index=0,timerId=null;

/* ================== MODE ================== */
mode.onchange=()=>timerOptions.classList.toggle("hidden",mode.value!=="timer");

/* ================== GLOBAL BACK ================== */
globalBackBtn.onclick=goHome;

document.addEventListener("keydown",e=>{
  if(e.altKey && e.key==="ArrowLeft"){
    if(!setup.classList.contains("hidden")){
      e.preventDefault();
      goHome();
    }
  }
});

function goHome(){
  clearInterval(timerId);
  quiz.classList.add("hidden");
  chartPage.classList.add("hidden");
  setup.classList.remove("hidden");
  globalBackBtn.classList.add("hidden");
  progress.style.width="0%";
  timer.textContent="";
  answer.value="";
}

/* ================== QUIZ ================== */
startBtn.onclick=()=>{
  pool=[];
  if(useHira.checked && useBasic.checked) pool.push(...HIRA_BASIC);
  if(useKata.checked && useBasic.checked) pool.push(...KATA_BASIC);
  if(useCombined.checked){
    if(useHira.checked) pool.push(...HIRA_COMBINED);
    if(useKata.checked) pool.push(...KATA_COMBINED);
  }
  if(!pool.length) return alert("Select something");
  pool.sort(()=>Math.random()-0.5);
  index=0;
  setup.classList.add("hidden");
  quiz.classList.remove("hidden");
  globalBackBtn.classList.remove("hidden");
  nextKana();
};

function nextKana(){
  kana.textContent=pool[index][0];
  answer.value="";
  answer.focus();
  progress.style.width=`${(index/pool.length)*100}%`;
  if(mode.value==="timer") startTimer();
  else timer.textContent="";
}

function startTimer(){
  clearInterval(timerId);
  let t=parseInt(customTime.value||timePreset.value);
  timer.textContent=`‚è± ${t}s`;
  timerId=setInterval(()=>{
    t--; timer.textContent=`‚è± ${t}s`;
    if(t<=0){ clearInterval(timerId); submit(false); }
  },1000);
}

answer.addEventListener("keydown",e=>{
  if(e.key==="Enter") submit(answer.value.trim().toLowerCase()===pool[index][1]);
});

function submit(ok){
  clearInterval(timerId);
  answer.className=ok?"correct":"wrong";
  setTimeout(()=>{
    answer.className="";
    index++;
    index>=pool.length?goHome():nextKana();
  },400);
}

/* ================== CHART ================== */
function openChart(type){
  setup.classList.add("hidden");
  chartPage.classList.remove("hidden");
  globalBackBtn.classList.remove("hidden");

  chartTitle.textContent=type==="hiragana"?"Hiragana Chart":"Katakana Chart";

  chartBasic.innerHTML=render(type==="hiragana"?HIRA_BASIC:KATA_BASIC);
  chartDakuten.innerHTML=render(type==="hiragana"?HIRA_DAKUTEN:KATA_DAKUTEN);
  chartHandakuten.innerHTML=render(type==="hiragana"?HIRA_HANDAKUTEN:KATA_HANDAKUTEN);
  chartCombined.innerHTML=render(type==="hiragana"?HIRA_COMBINED:KATA_COMBINED);
}

function render(arr){
  return arr.map(k=>`<div class="chart-item"><div class="chart-char">${k[0]}</div><div class="chart-romaji">${k[1]}</div></div>`).join("");
}

exportPdfBtn.onclick=()=>window.print();
</script>
</body>
</html>
